<script>
// This file is the invoice that contains the calculations based on the quantity & product selected from the products_display page. 
// Melissa Yago 11/14/19 Code was adapted from Invoice 2 WOD Exercise 
//Gif is taken from giphy site

</script>
<script src="cookie_data.js"></script>

<script>
  let params = (new URL(document.location)).searchParams; //Parses out the URL starting with the file name, quantity and purchase submit.
  var quantities = [];

  // Form was submitted so initiate the invoice by taking the quantities that were submitted for each product
  //If you went to invoice.html directly without submitting anything, you will get a no form submitted
  if (params.has('purchase_submit')) { 
    for (i = 0; i < products.length; i++) {
      if (params.has(`quantity${i}`)) {
        a_qty = params.get(`quantity${i}`); //Retrieves quanitity of products selected
        quantities[i] = a_qty; 
      }
    }
  } else { 
    document.write('no form submitted');
  }
  console.log(quantities); //writes out quantities
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document </title>

</head>
<link href="https://fonts.googleapis.com/css?family=Cherry+Swash|Raleway" rel="stylesheet"> 
<header>Ash & Mel's Cookies (Invoice)</header>
<link rel="stylesheet" href="style.css"
<body>
  <table border="2">
    <tbody>
      <tr> 
        <th style="text-align: center;" width="43%">Cookies</th>
        <th style="text-align: center;" width="11%">Quantity</th>
        <th style="text-align: center;" width="13%">Price</th>
        <th style="text-align: center;" width="54%">Extended price</th>
      </tr> 

      <script>
        subtotal = 0; //starting amount till prices are calculated and added up
        //If the quantity's of the products are greater than 0, calculate extended price, subtotal and document write the products purchased, quantities of each, price and extended price.
        for (i = 0; i < products.length; i++) {
          if (quantities[i] > 0)  // product row
          {
            extended_price = quantities[i] * products[i].Price
            subtotal += extended_price;
            document.write(`
      <tr>
        <td width="43%">${products[i].Cookie}</td>
        <td align="center" width="11%">${quantities[i]}</td>
        <td width="13%">\$${products[i].Price.toFixed(2)}</td>
        <td width="54%">\$${extended_price.toFixed(2)}</td>
      </tr>
      `); 
          }
        }

        // Compute tax
        var tax_rate = 0.04;
        var tax = tax_rate * subtotal;

        // Compute shipping
        if (subtotal <= 50) {
          shipping = 5;
        }
        else if (subtotal <= 100) {
          shipping = 10;
        }
        else {
          shipping = 0.05 * subtotal; // 5% of subtotal
        }

        // Compute grand total
        var total = subtotal + tax + shipping;
      </script>
      
      
      <script>
      // Below is the creation of the table. Note that toFixed(2) sets the number to two decimal places and that the table writes out the tax, subtotal, shipping and total.
      </script>
      <tr>
        <td colspan="4" width="100%">&nbsp;</td> 
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
        <td width="54%">$
          <script>document.write(subtotal.toFixed(2));</script>
        </td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%"><span>Tax at
            <script>document.write(100 * tax_rate);</script>%</span></td>
        <td width="54%">$
          <script>document.write(tax.toFixed(2));</script>
        </td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%">Shipping</span></td>
        <td width="54%">$
          <script>document.write(shipping.toFixed(2));</script>
        </td>
      </tr>
      <tr>
        <td style="text-align: center;" colspan="3" width="67%"><strong>Total</strong></td>
        <td width="54%"><strong>$
            <script>document.write(total.toFixed(2));</script></strong></td> 
      </tr>
    </tbody>
  </table>

  <div id="Policy">
    <br><b>
      OUR SHIPPING POLICY IS: A subtotal $0 - $49.99 will be $5 shipping.
      A subtotal $50 - $99.99 will be $10 shipping.
      Subtotals over $100 will be charged 5% of the subtotal amount. 
    </b> </div>
    <h1>
       Thank you for shopping!!!
    </h1>
    </style><iframe src="https://giphy.com/embed/xT0xeMA62E1XIlup68" width="480" class="center" height="270" frameBorder="0"  allowFullScreen></iframe>
   
  </body>

</html>
